------------------------------ unfixed ------------------------------
# 家計簿アプリ「やさしい家計簿さん」
「やさしい家計簿さん」リポジトリへようこそ！これは、日々の収支を手軽に記録・管理できる、モダンなWebアプリケーションです。目標達成度合いに応じて、アプリトップページのイラストが変わるといった、利用者のモチベーションが上がるようなUIを提供します。


# アプリの概要
「やさしい家計簿さん」は以下の特徴を持つ家計簿アプリです。
- **入出金明細の登録**: 日々の出費や収入を簡単に記録。
- **明細の一覧・分析**: 登録したデータを分かりやすく表示・集計。
- **予算管理**: 月ごとの予算を設定し、支出をコントロール。


# 現在のスタック
- **フロントエンド**: Next.js (App Router), React, TypeScript, Material-UI (MUI)
- **バックエンド**: Next.js (Route Handlers, Server Actions)
- **データベース**: PostgreSQL
- **ORM**: Prisma
- **テスト**:
    - **ユニット/結合**: Vitest, React Testing Library
    - **E2E**: Playwright
- **コンテナ環境**: Docker, Docker Compose


# 開発環境セットアップ
このプロジェクトはDockerを使用して、全ての開発環境（Next.js, PostgreSQL, Adminer）を一度に構築します。

### 1. リポジトリのクローン

Bash
```
git clone <リポジトリのURL>
cd <リポジトリ名>
```

### 2. 環境変数の設定
//TO DO　あとで詳細記載

### 3. Dockerイメージのビルドとコンテナの起動

以下のコマンドで、必要なDockerイメージをビルドし、コンテナをバックグラウンドで起動します。

Bash

```
docker-compose up -d --build
```

`http://localhost:3002`にアクセスして、アプリのトップページが表示されれば成功です。

# 開発コマンド一覧

開発中の主な操作は、`docker-compose`コマンド経由でコンテナに対して行います。

- **開発サーバーの起動**:
    
    Bash
    
    ```
    docker-compose up -d
    ```
    
- **コンテナの停止**:
    
    Bash
    
    ```
    docker-compose down
    ```
    
- **ユニットテストの実行**:
    
    Bash
    
    ```
    docker-compose exec next npm test
    ```
    
- **E2Eテストの実行**:
    
    Bash
    
    ```
    # サーバーが起動している状態で実行
    docker-compose exec next npm run test:e2e
    ```
    
- **コンテナの中に入る (シェル操作)**:
    
    Bash
    
    ```
    docker-compose exec next sh
    ```

# プロジェクト構造
//TO DO　あとで記載
```

```


# テストポリシー

## 基本ルール

- コンポーネントのテストは、**Vitest**と**React Testing Library (RTL)**を用いて行います。
- E2E（End-to-End）テストは**Playwright**を用いて、ユーザーの主要な操作フローをテストします。
- テストカバレッジは、プロジェクト全体で**80%以上**を目標とします。


## フェーズ別テスト戦略
#### 1. ユニットテスト (Vitest + RTL)
- **目的**: コンポーネントやカスタムフックが単体、または連携して正しく動作することを保証します。
- **対象とテスト内容の例**:
    - **レイアウトコンポーネント (`ClientLayout.tsx`)**:
        - **内容**: コンポーネントをレンダリングした際に、「明細一覧」や「予算管理」など、期待されるナビゲーションリンクが全て表示されていることを検証します。
        - **コードイメージ**: `screen.getByRole('button', { name: /明細一覧/i })` を使い、特定の名前のボタン（リンクの役割を持つ）が存在するかを確認します。
    - **データ表示コンポーネント (`detail/listing/page.tsx`)**:
        - **(正常系)** `useSWR`から受け取ったデータ（明細の配列）が、リストとして画面に正しく`map`関数で描画されることを確認します。
        - **(Loading中)** データ取得中に「Loading...」などのローディング表示が正しく行われることを確認します。
        - **(エラー時)** データ取得に失敗した際に、エラーメッセージが適切に表示されることを確認します。
        - **(画面遷移)** 「新規登録」ボタンがクリックされた際、`useRouter`の`push`関数が正しいパス（`/register/add`）で呼び出されることを、モックを使って検証します。
- **実行タイミング**: `git push`時にCIで自動実行。

#### 2. E2Eテスト (Playwright)
- **目的**: ユーザーの操作シナリオを通して、システム全体が連携して正しく機能することを保証します。
- **対象とテスト内容の例**:
    - **ページ遷移**:
        - **内容**: ブラウザを起動し、ホームページのヘッダーにある「明細一覧」リンクをクリックしたら、URLが正しく`/detail/listing`に変わることを検証します。
    - **主要なユーザーシナリオ**:
        - 入出金明細の登録フォーム入力から、一覧画面での表示確認までの一連の流れ。
        - 予算の登録・更新と、それが月次集計に反映されることの確認。
- **実行タイミング**: `develop`ブランチへのマージ時や、本番デプロイ前のCIで自動実行。

### テスト環境

- **テストDB**: //TO DO何書くか考える
- **ブラウザ**: Playwright用のDockerイメージに含まれるChromium, Firefox, WebKitを使用します。
- **モック**: API通信は`page.route()`を用いてモック化し、外部依存のない安定したテストを実行します。


## カバレッジ目標

- **全体目標**: **80%**
    
- **重点領域 (90%以上を目指す)**:
    
    - **状態やインタラクションを持つUIコンポーネント** (`BudgetForm.tsx`, `SummaryChart.tsx`など)
        
    - **Server Actions / Route Handlers** (データベースへの書き込みなどのビジネスロジック


